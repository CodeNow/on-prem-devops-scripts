---
- name: Check to see if pip is already installed.
  become: true
  command: "pip --version"
  ignore_errors: true
  changed_when: false # read-only task
  check_mode: no
  register: pip_is_installed

- name: Download pip.
  become: true
  get_url: url=https://bootstrap.pypa.io/get-pip.py dest=./
  when: pip_is_installed.rc != 0

- name: Install pip.
  command: "python ./get-pip.py"
  become: true
  when: pip_is_installed.rc != 0

- name: Install aws cli
  become: true
  pip:
    name: awscli
    executable: pip

- name: Put ECR docker login script in place
  become: yes
  template:
    src: ecr-docker-login.sh
    mode: 0744
    dest: /opt/runnable/ecr-docker-login.sh

- name: Run script for cron job
  tags: test_docker_login
  when: test_docker_login is defined
  become: yes
  shell: /opt/runnable/ecr-docker-login.sh

- name: put script into cron
  become: yes
  cron:
    name: ecr-docker-login
    state: present
    minute: "*/5"
    job: /opt/runnable/ecr-docker-login.sh

